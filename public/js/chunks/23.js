(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{218:function(t,e,i){"use strict";i.r(e);var s=i(32),r=i.n(s),n=i(2),a=i(26),u=i.n(a);function o(t){return function(t){if(Array.isArray(t))return l(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return l(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return l(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var c={components:{VJstree:r.a,TiptapVuetify:n.o,draggable:u.a},data:function(){return{url:"traduction_rubriques",dataTree:[],times:[],search:"",headers:[{text:"",sortable:!1},{text:"Question",align:"middle",value:"label"},{text:"Type",align:"middle",value:"type_label"},{text:"Obligatoire",align:"middle",value:"required"},{text:"",align:"right",value:"actions",sortable:!1}],validationErrors:null,types:[],listes:[],rubriques:[],rubrique:{id:null,parent_id:null,text:null,codif:null,color:null,icon:null,image:null,montant:null,presentation:null,description:null,time_to_deliver:null,enable:null,show_menu:null,show_calendar:null,first_rubrique:null,icon_url:null,image_url:null,children:[],questions:[]},question:{id:null,rubrique_id:null,label:null,type:null,liste:null,description:null,required:null,reponses:[]},extensions:[n.g,n.j,n.q,n.n,n.i,n.k,n.c,n.b],edit:!1}},mounted:function(){new KTImageInput("kt_user_edit_avatar_icon"),new KTImageInput("kt_user_edit_avatar_image")},created:function(){this.fetch()},methods:{editStatut:function(t){this.edit=!0,$.each(this.rubrique,function(e,i){this.rubrique[e]=t[e]}.bind(this)),this.get_questions()},itemClick:function(t){this.edit=!0,$.each(this.rubrique,function(e,i){this.rubrique[e]=t.model[e]}.bind(this))},saveOrder:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.overlay=!0;var i={};i.dataTree=this.dataTree,axios.post("traduction_rubriques/save_order",i).then(function(t){this.fetch(),e||swal.fire(t.data.title,t.data.message,t.data.icon)}.bind(this)).catch((function(e){t.overlay=!1,console.log("check error: ",t.error)}))},fetch:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e={};this.$route.query.t&&(e.t=this.$route.query.t),axios.get(this.url,{params:e}).then(function(e){this.rubriques=e.data.rubriques,this.dataTree=e.data.dataTree,t&&this.saveOrder(!0)}.bind(this)).catch((function(t){return console.log(t)}))},get_questions:function(){var t={};t.rubrique_id=this.rubrique.id,axios.get("questions",{params:t}).then(function(t){this.rubrique.questions=t.data.questions}.bind(this)).catch((function(t){return console.log(t)}))},deleteStatut:function(t){swal.fire({title:"Êtes-vous sûr ?",text:"Vous êtes sur le point de supprimer cette rubrique !",type:"question",showCancelButton:!0,confirmButtonText:"Supprimer",cancelButtonText:"Annuler"}).then(function(e){var i=this;e.value&&axios.post(this.url+"/"+t,{_method:"DELETE"}).then((function(t){swal.fire("Service supprimé !","Le service a été supprimé avec succés.","success"),i.fetch()})).catch((function(t){return console.log(t)}))}.bind(this))},deleteQuestion:function(t){swal.fire({title:"Êtes-vous sûr ?",text:"Vous êtes sur le point de supprimer cette question !",type:"question",showCancelButton:!0,confirmButtonText:"Supprimer",cancelButtonText:"Annuler"}).then(function(e){var i=this;e.value&&axios.post("questions/"+t,{_method:"DELETE"}).then((function(e){swal.fire("Question supprimée !","La question a été supprimée avec succés.","success");var s=i.rubrique.questions.find((function(e){return e.id===t})),r=i.rubrique.questions.indexOf(s);i.rubrique.questions.splice(r,1),i.rubrique.questions=o(i.rubrique.questions)})).catch((function(t){return console.log(t)}))}.bind(this))},saveStatut:function(t){var e=this;t.target.disabled=!0,t.target.classList.toggle("spinner");var i=new FormData;$.each(this.rubrique,(function(t,e){i.append(t,e)})),i.append("questions",JSON.stringify(this.rubrique.questions)),axios.post(this.url,i,{headers:{"content-type":"multipart/form-data"}}).then((function(i){t.target.disabled=!1,t.target.classList.toggle("spinner"),e.clearForm(),swal.fire("Service enregistrée !","La rubrique a été enregistrée avec succés.","success"),e.fetch(!0)})).catch((function(i){t.target.disabled=!1,t.target.classList.toggle("spinner"),422==i.response.status&&(e.validationErrors=i.response.data.errors)}))},addStatut:function(){this.clearForm(),this.validationErrors=null},addQuestion:function(){this.clearFormQuestion(),this.validationErrors=null},editQuestion:function(t){console.log(this.rubrique.questions),$("#modal_form_question").modal("toggle"),this.validationErrors=null,this.edit=!0,$.each(this.question,function(e,i){this.question[e]=t[e]}.bind(this))},saveQuestion:function(t){var e=this;t.target.disabled=!0,t.target.classList.toggle("spinner");var i=new FormData;$.each(this.question,(function(t,e){i.append(t,e||"")})),this.rubrique&&i.append("rubrique_id",this.rubrique.id),i.append("reponses",JSON.stringify(this.question.reponses)),axios.post("questions",i,{headers:{"content-type":"multipart/form-data"}}).then((function(i){if(t.target.disabled=!1,t.target.classList.toggle("spinner"),i.data.question)if(e.rubrique.questions.filter((function(t){return t.id==i.data.question.id}))[0]){var s=e.rubrique.questions.find((function(t){return t.id===i.data.question.id})),r=e.rubrique.questions.indexOf(s);e.rubrique.questions.splice(r,1,i.data.question),e.rubrique.questions=o(e.rubrique.questions)}else e.rubrique.questions.push(i.data.question);e.clearFormQuestion(),$("#modal_form_question").modal("toggle")})).catch((function(i){t.target.disabled=!1,t.target.classList.toggle("spinner"),422==i.response.status&&(e.validationErrors=i.response.data.errors)}))},removeKeywords:function(t){this.question.reponses.splice(this.question.reponses.indexOf(t),1),this.question.reponses=o(this.question.reponses)},clearForm:function(){this.edit=!1,$.each(this.rubrique,function(t,e){this.rubrique[t]=null}.bind(this)),this.rubrique.questions=[]},clearFormQuestion:function(){this.edit=!1,$.each(this.question,function(t,e){this.question[t]=null}.bind(this))},onImageChange:function(t){this.rubrique.icon=t.target.files[0]},onImageChangeModele:function(t){this.rubrique.image=t.target.files[0]}}},d=i(4),b=Object(d.a)(c,(function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",[i("div",{staticClass:"subheader py-2 py-lg-4 subheader-solid",attrs:{id:"kt_subheader"}},[i("div",{staticClass:"container-fluid d-flex align-items-center justify-content-between flex-wrap flex-sm-nowrap"},[i("div",{staticClass:"d-flex align-items-center flex-wrap mr-2"},[i("h5",{staticClass:"text-dark font-weight-bold mt-2 mb-2 mr-5"},[t._v("Rubriques")]),t._v(" "),i("div",{staticClass:"d-flex align-items-center",attrs:{id:"kt_subheader_search"}},[i("span",{staticClass:"text-dark-50 font-weight-bold",attrs:{id:"kt_subheader_total"}},[t._v(t._s(t.types.length)+" rubriques")])])])])]),t._v(" "),i("div",{staticClass:"d-flex flex-column-fluid"},[i("div",{staticClass:"container-fluid"},[i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-5"},[i("div",{staticClass:"card card-custom gutter-b"},[t._m(0),t._v(" "),i("div",{staticClass:"card-body p-0 pt-5"},[i("v-draggable-treeview",{scopedSlots:t._u([{key:"label",fn:function(e){var s=e.item;return[i("div",{staticClass:"d-flex"},[s.parent_id?i("span",[i("span",{staticClass:"label label-sm mr-2",class:{"label-danger":!s.enable,"label-success":s.enable}})]):t._e(),t._v(" "),i("span",[t._v(t._s(s.label))])])]}},{key:"append",fn:function(e){var s=e.item;return[i("a",{staticClass:"btn btn-icon btn-light btn-sm",attrs:{href:"#"},on:{click:function(e){return t.editStatut(s)}}},[i("span",{staticClass:"svg-icon svg-icon-md svg-icon-success"},[i("i",{staticClass:"flaticon-edit"})])])]}}]),model:{value:t.dataTree,callback:function(e){t.dataTree=e},expression:"dataTree"}}),t._v(" "),i("div",{staticClass:"text-center p-3"},[i("a",{staticClass:"btn btn-light-primary mr-2",attrs:{href:"#"},on:{click:function(e){return t.saveOrder()}}},[i("i",{staticClass:"ki ki-check icon-sm"}),t._v("\n                  Enregistrer l'ordre actuel\n                ")])]),t._v(" "),t._e()],1)])]),t._v(" "),i("div",{staticClass:"col-md-7"},[i("form",{staticClass:"mb-3"},[i("div",{staticClass:"card card-custom card-sticky",attrs:{id:"kt_page_sticky_card_"}},[i("div",{staticClass:"card-header"},[i("div",{staticClass:"card-title"},[t.rubrique.id?t._e():i("h3",{staticClass:"card-label"},[t._v("Ajouter une rubrique")]),t._v(" "),t.rubrique.id?i("h3",{staticClass:"card-label"},[t._v("Modifier une rubrique")]):t._e()]),t._v(" "),i("div",{staticClass:"card-toolbar"},[t.rubrique.id?i("a",{staticClass:"btn btn-light-primary mr-2",attrs:{href:"#"},on:{click:function(e){return t.clearForm()}}},[i("i",{staticClass:"ki ki-long-arrow-back icon-sm"}),t._v("\n                    Retour\n                  ")]):t._e(),t._v(" "),i("div",{staticClass:"btn-group"},[i("button",{staticClass:"btn btn-primary spinner-light-success spinner-right",attrs:{type:"submit",disabled:!t.rubrique.text},on:{click:function(e){return t.saveStatut(e)}}},[i("i",{staticClass:"ki ki-check icon-sm"}),t._v("\n                      Enregistrer\n                    ")]),t._v(" "),i("button",{staticClass:"btn btn-primary dropdown-toggle dropdown-toggle-split",attrs:{type:"button",disabled:!t.rubrique.text,"data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false"}}),t._v(" "),i("div",{staticClass:"dropdown-menu dropdown-menu-sm dropdown-menu-right"},[i("ul",{staticClass:"nav nav-hover flex-column pl-0"},[t.rubrique.id&&0==t.rubrique.children.length?i("li",{staticClass:"nav-item"},[i("a",{staticClass:"nav-link",attrs:{href:"#"},on:{click:function(e){return t.deleteStatut(t.rubrique.id)}}},[i("i",{staticClass:"nav-icon flaticon-delete"}),t._v(" "),i("span",{staticClass:"nav-text"},[t._v("Supprimer")])])]):t._e()])])])])]),t._v(" "),i("div",{staticClass:"card-body"},[i("form",{staticClass:"form",attrs:{id:"kt_form"}},[i("div",{staticClass:"tab-content mt-5",attrs:{id:"myTabContent"}},[i("div",{},[i("h4",{staticClass:"text-dark font-weight-bold mb-4"},[t._v("Informations :")]),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-8"},[i("div",{staticClass:"form-group"},[i("label",[t._v("Rubrique")]),t._v(" "),i("v-autocomplete",{attrs:{items:t.rubriques,clearable:"",dense:"",solo:""},model:{value:t.rubrique.parent_id,callback:function(e){t.$set(t.rubrique,"parent_id",e)},expression:"rubrique.parent_id"}})],1),t._v(" "),i("div",{staticClass:"row"},[i("div",{staticClass:"col-md-12 pt-0"},[i("div",{staticClass:"form-group mb-0"},[i("label",{staticClass:"form-control-label",attrs:{for:"recipient-name"}},[t._v("Titre")]),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.rubrique.text,expression:"rubrique.text"}],staticClass:"form-control",attrs:{type:"text",placeholder:"Titre"},domProps:{value:t.rubrique.text},on:{input:function(e){e.target.composing||t.$set(t.rubrique,"text",e.target.value)}}})])])])])])])])])])])])])])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"card-header"},[e("div",{staticClass:"card-title"},[e("h3",{staticClass:"card-label"},[this._v("Rubriques")])])])}],!1,null,null,null);e.default=b.exports}}]);